<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Autenticación</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div id="app"></div>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/vue-router@4/dist/vue-router.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script type="module">
        // Componente Login
        const Login = {
            template: `
                <div>
                    <div v-if="message" :class="['alert', messageType === 'success' ? 'alert-success' : 'alert-error']">
                        {{ message }}
                    </div>
                    
                    <form @submit.prevent="handleLogin">
                        <div class="form-group">
                            <label for="email">Correo Electrónico</label>
                            <input
                                type="email"
                                id="email"
                                v-model="form.email"
                                required
                                placeholder="Ingresa tu correo"
                            />
                        </div>
                        
                        <div class="form-group">
                            <label for="password">Contraseña</label>
                            <input
                                type="password"
                                id="password"
                                v-model="form.password"
                                required
                                placeholder="Ingresa tu contraseña"
                            />
                        </div>
                        
                        <button type="submit" class="btn" :disabled="loading">
                            {{ loading ? 'Iniciando sesión...' : 'Iniciar Sesión' }}
                        </button>
                    </form>
                    
                    <div class="switch-form">
                        ¿No tienes cuenta? <router-link to="/register">Regístrate aquí</router-link>
                    </div>
                </div>
            `,
            data() {
                return {
                    form: { email: '', password: '' },
                    loading: false,
                    message: '',
                    messageType: ''
                }
            },
            methods: {
                async handleLogin() {
                    this.loading = true;
                    this.message = '';
                    
                    try {
                        const response = await axios.post('http://localhost:8000/api/login', {
                            email: this.form.email,
                            password: this.form.password
                        });
                        
                        this.message = 'Inicio de sesión exitoso';
                        this.messageType = 'success';
                        console.log('Login successful:', response.data);
                        
                    } catch (error) {
                        this.message = error.response?.data?.detail || 'Error al iniciar sesión';
                        this.messageType = 'error';
                    } finally {
                        this.loading = false;
                    }
                }
            }
        };

        // Componente Register
        const Register = {
            template: `
                <div>
                    <div v-if="message" :class="['alert', messageType === 'success' ? 'alert-success' : 'alert-error']">
                        {{ message }}
                    </div>
                    
                    <form @submit.prevent="handleRegister">
                        <div class="form-group">
                            <label for="name">Nombre Completo</label>
                            <input
                                type="text"
                                id="name"
                                v-model="form.name"
                                required
                                placeholder="Ingresa tu nombre completo"
                            />
                        </div>
                        
                        <div class="form-group">
                            <label for="email">Correo Electrónico</label>
                            <input
                                type="email"
                                id="email"
                                v-model="form.email"
                                required
                                placeholder="Ingresa tu correo"
                            />
                        </div>
                        
                        <div class="form-group">
                            <label for="password">Contraseña</label>
                            <input
                                type="password"
                                id="password"
                                v-model="form.password"
                                required
                                placeholder="Ingresa tu contraseña"
                                minlength="6"
                            />
                        </div>
                        
                        <div class="form-group">
                            <label for="confirmPassword">Confirmar Contraseña</label>
                            <input
                                type="password"
                                id="confirmPassword"
                                v-model="form.confirmPassword"
                                required
                                placeholder="Confirma tu contraseña"
                            />
                        </div>
                        
                        <button type="submit" class="btn" :disabled="loading">
                            {{ loading ? 'Registrando...' : 'Registrarse' }}
                        </button>
                    </form>
                    
                    <div class="switch-form">
                        ¿Ya tienes cuenta? <router-link to="/login">Inicia sesión aquí</router-link>
                    </div>
                </div>
            `,
            data() {
                return {
                    form: { name: '', email: '', password: '', confirmPassword: '' },
                    loading: false,
                    message: '',
                    messageType: ''
                }
            },
            methods: {
                async handleRegister() {
                    if (this.form.password !== this.form.confirmPassword) {
                        this.message = 'Las contraseñas no coinciden';
                        this.messageType = 'error';
                        return;
                    }
                    
                    this.loading = true;
                    this.message = '';
                    
                    try {
                        const response = await axios.post('http://localhost:8000/api/register', {
                            name: this.form.name,
                            email: this.form.email,
                            password: this.form.password
                        });
                        
                        this.message = 'Registro exitoso. Ahora puedes iniciar sesión.';
                        this.messageType = 'success';
                        
                        this.form = { name: '', email: '', password: '', confirmPassword: '' };
                        console.log('Registration successful:', response.data);
                        
                    } catch (error) {
                        this.message = error.response?.data?.detail || 'Error al registrar usuario';
                        this.messageType = 'error';
                    } finally {
                        this.loading = false;
                    }
                }
            }
        };

        // Configuración de rutas
        const routes = [
            { path: '/', redirect: '/login' },
            { path: '/login', component: Login },
            { path: '/register', component: Register }
        ];

        const router = VueRouter.createRouter({
            history: VueRouter.createWebHistory(),
            routes
        });

        // Aplicación principal
        const App = {
            template: `
                <div id="app">
                    <div class="container">
                        <div class="auth-card">
                            <div class="auth-header">
                                <h1>{{ $route.path === '/login' ? 'Iniciar Sesión' : 'Registro' }}</h1>
                            </div>
                            <router-view></router-view>
                        </div>
                    </div>
                </div>
            `
        };

        Vue.createApp(App).use(router).mount('#app');
    </script>
</body>
</html>
